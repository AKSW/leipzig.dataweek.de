---
layout: basic
---
{% include_cached strings.html %}
{% assign link = page.rdf | rdf_property: "dw:rel_link" %}
{% assign location = page.rdf | rdf_property: "schema:location" %}
{% assign date = page.rdf | rdf_property: "schema:date" %}

{% capture menu_query %}
SELECT (min(?iri) as ?link) ?date WHERE {
  ?iri rdf:type dw:RoomDay ;
    schema:date ?date .
} GROUP BY ?date ORDER BY ?date
{% endcapture %}
{% assign menudays = page.rdf | sparql_query: menu_query %}

{% capture roomdays_query %}
# This query selects all dw:RoomDay resources to help build
# the menu and mobile menu for each day and location
SELECT ?iri ?date ?location WHERE {
  ?iri rdf:type dw:RoomDay ;
    schema:date ?date ;
    schema:location ?location .
    filter(str(?date) = "{{ date }}")
} ORDER BY ?date ?location
{% endcapture %}
{% assign roomdays = page.rdf | sparql_query: roomdays_query %}
<div class="content-header">
<h1>{{ str_program_header }}</h1>
<nav class="nav-sub1" aria-label="Untermenü Stufe 1">
  <ul>
    {% for day in menudays %}
      {% assign weekday = day.date | localize: "%A"  %}
      {% if site.language == 'de' %}
       {% assign date_string = day.date | date: "%d.%m.%Y" %}
      {% else %}
        {% assign date_string = day.date %}
      {% endif %}
      {% if day.date == date %}
        <li class="open">
          <strong aria-current="page"><span>{{ date_string }}</span>{{ weekday }}</strong>
      {% else %}
        <li>
          <a href="{{ day.link.render_path | relativize_url }}"><span>{{ date_string }}</span>{{ weekday }}</a>
      {% endif %}
      </li>
    {% endfor %}
  </ul>
</nav>
</div>
<nav class="nav-sub2" aria-label="Untermenü Stufe 2">
<ul>
{% for day in roomdays %}
  {% assign location_name = day.location | rdf_property: "dct:title" %}
    {% if page.rdf == day.iri %}
      <li class="open">
        <strong aria-current="page">{{ location_name }}</strong>
      </li>
    {% else %}
      <li>
        <a href="{{ day.iri.render_path | relativize_url }}">{{ location_name }}</a>
      </li>
    {% endif %}
{% endfor %}
</ul>
</nav>
<section class="timetable">
{% capture events_query %}
  SELECT DISTINCT (?event as ?iri) ?title ?description ?datestring ?date
  WHERE {
    <{{ page.rdf }}> rdf:type dw:RoomDay ;
      schema:date ?date ;
      schema:location ?location .
    ?mainEvent schema:subEvent ?event .
    ?event schema:subEvent ?session ;
        dct:description ?eventDescription ;
        rdfs:label ?title ;
        schema:date ?date .
    FILTER(langMatches(lang(?title), "{{ site.language }}"))
    ?session schema:location ?location ;
      schema:startTime ?session_start .
  } ORDER BY ?session_start
{% endcapture %}
{% assign events = page.rdf | sparql_query: events_query %}
{% for event in events %}
  <header>
    <h2>
      {{ event.eventTitle }} <span>{{ event.datestring }}</span>
    </h2>
    <p class="calendar">
      <a href="programm_montag_bereich-a.html#">Tag als Kalender abonnieren <svg role="img" focusable="false" aria-hidden="true" height="28" width="28">
      <use xlink:href="/resources/images/icons.svg#calendar-add"></use></svg></a>
    </p>
  </header>
  {% capture sessions_query %}
  SELECT DISTINCT ?session
  WHERE {
    ?resourceUri schema:subEvent ?session ;
      schema:date ?date .
      ?session schema:startTime ?start .
      {
        ?session schema:location ?location ;
        filter (?location = <{{ location }}>)
      } union {
        ?session site:track dw:pause ;
      }
  } ORDER BY ?start
  {% endcapture %}
  {% assign sessions = event.iri | sparql_query: sessions_query %}
  {% for session_row in sessions %}
    {% include_cached components/program_session.html session=session_row.session %}
  {% endfor %}
{% endfor %}
